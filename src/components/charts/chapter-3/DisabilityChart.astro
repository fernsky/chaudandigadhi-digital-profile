---
import type { Language } from "../../../lib/i18n";
import { loadChapterSection } from "../../../lib/i18n/chapter-loader";
import D3BarChart from "../D3BarChart.astro";

interface Props {
    lang: Language;
}

const { lang } = Astro.props;

type DisabilityData = {
    total: Record<string, number>;
    columns: Record<string, string>;
};

const content = await loadChapterSection<DisabilityData>(3, "disability", lang);

if (!content) {
    throw new Error("Disability data not found");
}

const { total, columns } = content;

// Transform data for chart
const chartData = Object.entries(total)
    .filter(([key]) => key !== "total")
    .map(([key, count]) => ({
        type: columns[key] || key,
        count: count as number,
    }))
    .sort((a, b) => b.count - a.count);
---

<div class="space-y-6">
    <div class="w-full max-w-4xl mx-auto">
        <D3BarChart
            id="disability-chart"
            title=""
            labels={chartData.map((d) => d.type)}
            data={chartData.map((d) => d.count)}
            lang={lang}
            height={Math.max(400, chartData.length * 40)}
        />
    </div>
</div>
