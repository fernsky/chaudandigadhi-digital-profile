---
import type { Language } from "../../../lib/i18n";
import { loadChapterSection } from "../../../lib/i18n/chapter-loader";
import D3BarChart from "../D3BarChart.astro";

interface Props {
    lang: Language;
}

const { lang } = Astro.props;

type OccupationData = {
    tableData: Array<{
        occupation: string;
        total: number;
        percentage: number;
    }>;
};

const content = await loadChapterSection<OccupationData>(3, "occupation", lang);

if (!content) {
    throw new Error("Occupation data not found");
}

// Sort data by percentage descending
const sortedData = [...content.tableData].sort(
    (a, b) => b.percentage - a.percentage,
);
---

<div class="space-y-6">
    <div class="w-full max-w-4xl mx-auto">
        <D3BarChart
            id="occupation-distribution-chart"
            title=""
            labels={sortedData.map((d) => d.occupation)}
            data={sortedData.map((d) => d.total)}
            lang={lang}
            height={Math.max(400, sortedData.length * 40)}
        />
    </div>
</div>
