---
interface Props {
    data: {
        sector: string;
        area: number;
        percent: number;
    }[];
}

const { data } = Astro.props;

// Sort by percent descending
const chartData = [...data].sort((a, b) => b.percent - a.percent);

const colors = [
    "#10b981", // emerald-500 (Forest/Agri usually green)
    "#f59e0b", // amber-500
    "#3b82f6", // blue-500 (Water)
    "#8b5cf6", // violet-500
    "#ef4444", // red-500
    "#ec4899", // pink-500
    "#6366f1", // indigo-500
    "#14b8a6", // teal-500
    "#f97316", // orange-500
];
---

<div
    class="relative w-full h-[500px] bg-zinc-900/50 rounded-xl border border-zinc-800 p-6 backdrop-blur-sm flex flex-col md:flex-row items-center gap-8"
>
    <div class="flex-1 min-w-[300px] h-[300px] relative">
        <svg
            id="land-use-chart"
            viewBox="0 0 100 100"
            class="w-full h-full transform -rotate-90"></svg>
        <!-- Center Text -->
        <div
            class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none"
        >
            <span class="text-sm text-zinc-400">कुल क्षेत्रफल</span>
            <span class="text-xl font-bold text-white font-serif">283.78</span>
            <span class="text-xs text-zinc-500">वर्ग कि.मि.</span>
        </div>
    </div>

    <div class="flex-1 grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-3">
        {
            chartData.map((item, index) => (
                <div class="flex items-center gap-2">
                    <div
                        class="w-3 h-3 rounded-full flex-shrink-0"
                        style={`background-color: ${colors[index % colors.length]}`}
                    />
                    <div class="flex flex-col">
                        <span class="text-sm font-medium text-zinc-200">
                            {item.sector}
                        </span>
                        <div class="text-xs text-zinc-400">
                            <span>{item.percent}%</span>
                            <span class="mx-1">|</span>
                            <span>{item.area} वर्ग कि.मि.</span>
                        </div>
                    </div>
                </div>
            ))
        }
    </div>
</div>

<script is:inline define:vars={{ initialData: chartData, colors }}>
    const svg = document.getElementById("land-use-chart");

    if (svg) {
        const radius = 40;
        const circumference = 2 * Math.PI * radius;
        let offset = 0;

        initialData.forEach((item, index) => {
            const percent = item.percent / 100;
            const strokeDasharray = `${percent * circumference} ${circumference}`;
            const color = colors[index % colors.length];

            const circle = document.createElementNS(
                "http://www.w3.org/2000/svg",
                "circle",
            );
            circle.setAttribute("cx", "50");
            circle.setAttribute("cy", "50");
            circle.setAttribute("r", radius.toString());
            circle.setAttribute("fill", "transparent");
            circle.setAttribute("stroke", color);
            circle.setAttribute("stroke-width", "12"); // Thicker donut
            circle.setAttribute("stroke-dasharray", strokeDasharray);
            circle.setAttribute("stroke-dashoffset", (-offset).toString());
            circle.classList.add(
                "hover:opacity-80",
                "transition-opacity",
                "duration-300",
            );

            const title = document.createElementNS(
                "http://www.w3.org/2000/svg",
                "title",
            );
            title.textContent = `${item.sector}: ${item.percent}%`;
            circle.appendChild(title);

            svg.appendChild(circle);

            offset += percent * circumference;
        });
    }
</script>
