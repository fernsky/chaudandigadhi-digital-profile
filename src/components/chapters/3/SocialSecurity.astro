---
import { loadChapterSection } from "../../../lib/i18n/chapter-loader";
import { formatNumber } from "../../../lib/i18n/formatters";
import type { Language } from "../../../lib/i18n";

interface Props {
    lang: Language;
}

const { lang } = Astro.props;
const locale = lang === "ne" ? "ne-NP" : "en-US";

type SocialSecurityContent = {
    title: string;
    sectionId: string;
    number: string;
    table22: {
        title: string;
        header: string[];
        tableData: Array<{
            title: string;
            values: number[];
            total: number;
        }>;
        totalRow: number[];
        grandTotal: number;
        source: string;
    };
    paragraphs: string[];
};

const content = await loadChapterSection<SocialSecurityContent>(
    3,
    "social-security",
    lang,
);

if (!content) {
    throw new Error("Social security section content not found");
}

const parseParagraph = (p: string) => {
    // Replace markdown-style bold with HTML
    return p.replace(
        /\*\*(.*?)\*\*/g,
        '<b class="text-white font-bold">$1</b>',
    );
};
---

<section
    id="social-security"
    class="relative bg-[#050505] pb-8 md:pb-12 border-t border-[#f2e25d]/10 pt-8 mt-8"
>
    <div class="container mx-auto px-8">
        <div class="w-full">
            <!-- 3.13 Header -->
            <div class="mb-8">
                <h3
                    class="font-serif text-2xl md:text-3xl font-medium text-zinc-100 mb-6"
                >
                    {content.title}
                </h3>
            </div>

            <!-- Table 22 -->
            <div class="mb-12 w-full overflow-hidden">
                <div
                    class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4"
                >
                    <h4
                        class="font-serif text-xl md:text-2xl text-zinc-100 font-medium text-center md:text-left"
                    >
                        {content.table22.title}
                    </h4>
                </div>
                <div class="overflow-x-auto">
                    <table
                        class="w-full border-collapse bg-[#0a0a0a] border border-[#f2e25d]/10 text-xs md:text-sm text-center"
                    >
                        <thead>
                            <tr
                                class="bg-[#f2e25d]/20 border-b border-[#f2e25d]/20 text-white"
                            >
                                <th
                                    rowspan="2"
                                    class="px-2 py-4 border-r border-[#f2e25d]/10 font-serif font-medium sticky left-0 bg-[#1a1a14] z-10 min-w-[150px]"
                                >
                                    {content.table22.header[0]}
                                </th>
                                <th
                                    colspan="10"
                                    class="px-2 py-2 border-b border-[#f2e25d]/10 font-serif font-medium"
                                >
                                    {lang === "ne" ? "वडा नं." : "Ward No."}
                                </th>
                                <th
                                    rowspan="2"
                                    class="px-2 py-4 font-serif font-bold"
                                >
                                    {content.table22.header[11]}
                                </th>
                            </tr>
                            <tr class="bg-[#f2e25d]/10 text-zinc-100">
                                {
                                    content.table22.header
                                        .slice(1, 11)
                                        .map((h: string) => (
                                            <th class="px-2 py-3 border-r border-[#f2e25d]/10 font-serif font-medium w-12">
                                                {formatNumber(h, lang)}
                                            </th>
                                        ))
                                }
                            </tr>
                        </thead>
                        <tbody class="text-zinc-300 font-serif">
                            {
                                content.table22.tableData.map((row) => (
                                    <tr class="border-b border-[#f2e25d]/5 hover:bg-[#f2e25d]/5 transition-colors duration-200">
                                        <td class="px-3 py-3 border-r border-[#f2e25d]/5 text-left sticky left-0 bg-[#0a0a0a] z-10">
                                            {row.title}
                                        </td>
                                        {row.values.map((val: number) => (
                                            <td class="px-2 py-3 border-r border-[#f2e25d]/5">
                                                {formatNumber(val, lang)}
                                            </td>
                                        ))}
                                        <td class="px-2 py-3 font-medium text-white bg-[#f2e25d]/5">
                                            {formatNumber(row.total, lang)}
                                        </td>
                                    </tr>
                                ))
                            }
                            <tr
                                class="bg-[#f2e25d]/20 font-bold text-white uppercase"
                            >
                                <td
                                    class="px-3 py-4 border-r border-[#f2e25d]/10 text-left sticky left-0 bg-[#1a1a14] z-10"
                                >
                                    {lang === "ne" ? "जम्मा" : "Total"}
                                </td>
                                {
                                    content.table22.totalRow.map(
                                        (val: number) => (
                                            <td class="px-2 py-4 border-r border-[#f2e25d]/10">
                                                {formatNumber(val, lang)}
                                            </td>
                                        ),
                                    )
                                }
                                <td class="px-2 py-4">
                                    {
                                        formatNumber(
                                            content.table22.grandTotal,
                                            lang,
                                        )
                                    }
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                {lang === "ne" ? "स्रोत" : "Source"}: {content.table22.source}
            </div>
        </div>

        <!-- Paragraphs -->
        <div class="space-y-6 mt-12 pb-12">
            {
                content.paragraphs.map((p: string) => (
                    <p
                        class="text-zinc-100 font-serif text-lg md:text-xl font-light leading-relaxed text-justify"
                        set:html={parseParagraph(p)}
                    />
                ))
            }
        </div>
    </div>
</section>
