---
import { loadChapterSection } from "../../../lib/i18n/chapter-loader";
import { formatNumber } from "../../../lib/i18n/formatters";
import type { Language } from "../../../lib/i18n";

interface Props {
    lang: Language;
}

const { lang } = Astro.props;

type SettlementsContent = {
    title: string;
    number: string;
    subsection_title: string;
    subsection_number: string;
    content: string;
    table_title: string;
    table_number: string;
    source: string;
    table_data: Array<{
        ward: string;
        settlements: string;
    }>;
};

const content = await loadChapterSection<SettlementsContent>(
    3,
    "settlements",
    lang,
);

if (!content) {
    throw new Error("Settlements section content not found");
}
---

<section
    id="settlements"
    class="relative bg-[#050505] py-8 md:py-12 border-t border-[#f2e25d]/10"
>
    <div class="container mx-auto px-8">
        <div class="w-full">
            <!-- 3.1 Header -->
            <div class="mb-8">
                <h2
                    class="font-serif text-3xl md:text-4xl font-medium text-zinc-100 mb-6"
                >
                    {formatNumber(content.number, lang)}
                    {content.title}
                </h2>
            </div>

            <!-- 3.1.1 Subsection -->
            <div id="main-settlements" class="mb-12">
                <h3
                    class="font-serif text-2xl md:text-3xl font-medium text-zinc-100 mb-6"
                >
                    {formatNumber(content.subsection_number, lang)}
                    {content.subsection_title}
                </h3>

                <p
                    class="text-zinc-100 font-serif text-lg md:text-xl font-light leading-relaxed mb-10 whitespace-pre-line"
                >
                    {content.content}
                </p>

                <!-- Table -->
                <div class="mb-10 w-full">
                    <h4
                        class="font-serif text-xl md:text-2xl text-zinc-100 font-medium mb-4 text-center"
                    >
                        {formatNumber(content.table_number, lang)}: {
                            content.table_title
                        }
                    </h4>
                    <div class="overflow-x-auto">
                        <table
                            class="w-full border-collapse bg-[#0a0a0a] border border-[#f2e25d]/10 text-sm md:text-lg"
                        >
                            <thead>
                                <tr
                                    class="bg-[#f2e25d]/5 border-b border-[#f2e25d]/20"
                                >
                                    <th
                                        class="px-4 py-3 border-r border-[#f2e25d]/10 text-center w-24 font-serif text-zinc-100 font-medium"
                                    >
                                        {lang === "ne" ? "वडा नं." : "Ward No."}
                                    </th>
                                    <th
                                        class="px-4 py-3 text-left font-serif text-zinc-100 font-medium"
                                    >
                                        {
                                            lang === "ne"
                                                ? "नगरपालिकाका मुख्य बस्तीहरुको विवरण"
                                                : "Details of Main Settlements"
                                        }
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                {
                                    content.table_data.map((row: any) => (
                                        <tr class="border-b border-[#f2e25d]/5 hover:bg-[#f2e25d]/5 transition-colors duration-200">
                                            <td class="px-4 py-3 border-r border-[#f2e25d]/5 text-center font-medium text-zinc-100 font-serif">
                                                {formatNumber(row.ward, lang)}
                                            </td>
                                            <td class="px-4 py-3 text-zinc-100 font-serif">
                                                {row.settlements}
                                            </td>
                                        </tr>
                                    ))
                                }
                            </tbody>
                        </table>
                    </div>
                    <div
                        class="text-right text-zinc-400 font-serif italic text-sm mt-2"
                    >
                        {lang === "ne" ? "स्रोत" : "Source"}: {content.source}
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
