---
import type { Language } from "../../../lib/i18n";
import { loadChapterSections } from "../../../lib/i18n/chapter-loader";
import { formatNumber } from "../../../lib/i18n/formatters";
import SlopeDistributionChart from "../../charts/chapter-2/SlopeDistributionChart.astro";
import AspectDistributionChart from "../../charts/chapter-2/AspectDistributionChart.astro";

interface Props {
    lang: Language;
}

const { lang } = Astro.props;
const locale = lang === "ne" ? "ne-NP" : "en-US";
const markers = lang === "ne" ? ["क", "ख", "ग"] : ["a", "b", "c"];
const mapLabel = lang === "ne" ? "नक्सा नं." : "Map No.";

// Load all terrain subsections
const subsections = await loadChapterSections(
    2,
    ["terrain-soil", "terrain-slope", "terrain-aspect"],
    lang,
);
---

<div class="bg-[#050505]">
    <div class="container mx-auto px-8">
        <div class="w-full space-y-8">
            <!-- Soil Composition -->
            {
                subsections["terrain-soil"] && (
                    <div id="terrain-soil" class="space-y-4">
                        <h3 class="font-serif text-xl md:text-2xl text-zinc-100 font-medium">
                            {markers[0]}) {subsections["terrain-soil"].title}
                        </h3>
                        {subsections["terrain-soil"].content.map((para: any) => (
                            <p class="text-zinc-100 font-serif text-lg md:text-xl font-light leading-relaxed">
                                {para.text}
                            </p>
                        ))}
                    </div>
                )
            }

            <!-- Slope Analysis -->
            {
                subsections["terrain-slope"] && (
                    <div id="terrain-slope" class="space-y-6">
                        <h3 class="font-serif text-xl md:text-2xl text-zinc-100 font-medium">
                            {markers[1]}) {subsections["terrain-slope"].title}
                        </h3>
                        <p class="text-zinc-100 font-serif text-lg md:text-xl font-light leading-relaxed">
                            {subsections["terrain-slope"].intro}
                        </p>

                        <!-- Slope Map -->
                        {subsections["terrain-slope"].mapReference && (
                            <div class="flex flex-col items-center space-y-4">
                                <div class="w-full bg-[#0a0a0a] border border-[#f2e25d]/10 p-6 group hover:border-[#f2e25d]/30 transition-all duration-300">
                                    <div class="aspect-[4/3] bg-[#050505] flex items-center justify-center border border-[#f2e25d]/5">
                                        <img
                                            src={subsections["terrain-slope"].mapReference.image}
                                            alt={subsections["terrain-slope"].mapReference.title}
                                            class="w-full h-full object-contain"
                                            loading="lazy"
                                        />
                                    </div>
                                </div>
                                <p class="text-zinc-100 font-serif text-lg font-bold text-center">
                                    {mapLabel} {formatNumber(subsections["terrain-slope"].mapReference.number, lang)}: {subsections["terrain-slope"].mapReference.title}
                                </p>
                            </div>
                        )}

                        <!-- Slope Categories -->
                        <div class="space-y-6">
                            {subsections["terrain-slope"].categories.map((category: any, index: number) => (
                                <div class="space-y-2">
                                    <h4 class="font-serif text-lg md:text-xl text-zinc-100 font-medium">
                                        {category.marker}) {category.title}
                                    </h4>
                                    <p class="text-zinc-100 font-serif text-base md:text-lg font-light leading-relaxed">
                                        {category.description}
                                    </p>
                                </div>
                            ))}
                        </div>

                        <!-- Slope Distribution Chart -->
                        <div class="my-8">
                            <SlopeDistributionChart lang={lang} />
                        </div>

                        <!-- Conclusion -->
                        <p class="text-zinc-100 font-serif text-lg md:text-xl font-light leading-relaxed">
                            {subsections["terrain-slope"].conclusion}
                        </p>
                    </div>
                )
            }

            <!-- Aspect/Orientation -->
            {
                subsections["terrain-aspect"] && (
                    <div id="terrain-aspect" class="space-y-6">
                        <h3 class="font-serif text-xl md:text-2xl text-zinc-100 font-medium">
                            {markers[2]}) {subsections["terrain-aspect"].title}
                        </h3>
                        <p class="text-zinc-100 font-serif text-lg md:text-xl font-light leading-relaxed">
                            {subsections["terrain-aspect"].intro}
                        </p>

                        <!-- Aspect Distribution Chart -->
                        <div class="my-8">
                            <AspectDistributionChart lang={lang} />
                        </div>

                        <!-- Aspect Map -->
                        {subsections["terrain-aspect"].mapReference && (
                            <div class="flex flex-col items-center space-y-4">
                                <div class="w-full bg-[#0a0a0a] border border-[#f2e25d]/10 p-6 group hover:border-[#f2e25d]/30 transition-all duration-300">
                                    <div class="aspect-[4/3] bg-[#050505] flex items-center justify-center border border-[#f2e25d]/5">
                                        <img
                                            src={subsections["terrain-aspect"].mapReference.image}
                                            alt={subsections["terrain-aspect"].mapReference.title}
                                            class="w-full h-full object-contain"
                                            loading="lazy"
                                        />
                                    </div>
                                </div>
                                <p class="text-zinc-100 font-serif text-lg font-bold text-center">
                                    {mapLabel} {formatNumber(subsections["terrain-aspect"].mapReference.number, lang)}: {subsections["terrain-aspect"].mapReference.title}
                                </p>
                            </div>
                        )}
                    </div>
                )
            }
        </div>
    </div>
</div>
