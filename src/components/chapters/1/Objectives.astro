---
import type { Language } from "../../../lib/i18n";
import { loadChapterSection } from "../../../lib/i18n/chapter-loader";

interface Props {
    lang: Language;
}

const { lang } = Astro.props;

type ObjectivesContent = {
    title: string;
    sectionId: string;
    intro: string;
    objectives: Array<{
        marker: string;
        title: string;
        description: string;
        icon: string;
    }>;
};

const content = await loadChapterSection<ObjectivesContent>(
    1,
    "objectives",
    lang,
);

if (!content) {
    throw new Error("Objectives section content not found");
}
---

<section
    id="objectives"
    class="relative min-h-[70vh] bg-[#050505] py-24 md:py-32"
>
    <div class="container mx-auto px-8 relative z-10">
        <!-- Section Header -->
        <div class="max-w-4xl mx-auto mb-20 reveal-item">
            <h2
                class="font-serif text-[clamp(2.5rem,5vw,4.5rem)] md:text-[5rem] leading-[1.1] font-medium text-white tracking-tight mb-12"
            >
                {content.title}
            </h2>

            <!-- Introduction -->
            <p
                class="text-zinc-400 font-serif text-xl md:text-2xl leading-relaxed"
            >
                {content.intro}
            </p>
        </div>

        <!-- Objectives List -->
        <div class="max-w-4xl mx-auto space-y-16">
            {
                content.objectives.map((objective, index) => (
                    <div
                        class="reveal-item"
                        style={`--delay: ${(index + 1) * 150}ms`}
                    >
                        <div class="group border-b border-zinc-900 pb-12 transition-all duration-700">
                            <h3 class="font-serif text-2xl md:text-3xl text-white mb-4 tracking-tight leading-tight group-hover:text-zinc-300 transition-colors">
                                {objective.title}
                            </h3>

                            <p class="text-zinc-500 font-serif text-lg md:text-xl leading-relaxed">
                                {objective.description}
                            </p>
                        </div>
                    </div>
                ))
            }
        </div>
    </div>
</section>

<style>
    .reveal-item {
        opacity: 0;
        transform: translateY(40px);
        transition:
            opacity 1s cubic-bezier(0.2, 0.8, 0.2, 1),
            transform 1s cubic-bezier(0.2, 0.8, 0.2, 1);
        transition-delay: var(--delay, 0ms);
    }

    .reveal-item.active {
        opacity: 1;
        transform: translateY(0);
    }

    .objective-card {
        position: relative;
    }

    .objective-card::before {
        content: "";
        position: absolute;
        inset: 0;
        background: radial-gradient(
            600px circle at var(--mouse-x, 50%) var(--mouse-y, 50%),
            rgba(255, 255, 255, 0.06),
            transparent 40%
        );
        opacity: 0;
        transition: opacity 0.5s;
        pointer-events: none;
    }

    .objective-card:hover::before {
        opacity: 1;
    }
</style>

<script>
    // Intersection Observer for reveal animations
    const observerOptions = {
        threshold: 0.1,
        rootMargin: "0px 0px -100px 0px",
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
            if (entry.isIntersecting) {
                entry.target.classList.add("active");
            }
        });
    }, observerOptions);

    document.querySelectorAll(".reveal-item").forEach((item) => {
        observer.observe(item);
    });

    // Mouse move effect for objective cards
    document.querySelectorAll(".objective-card").forEach((card) => {
        const htmlCard = card as HTMLElement;
        htmlCard.addEventListener("mousemove", (e: MouseEvent) => {
            const rect = htmlCard.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            htmlCard.style.setProperty("--mouse-x", `${x}px`);
            htmlCard.style.setProperty("--mouse-y", `${y}px`);
        });
    });
</script>
