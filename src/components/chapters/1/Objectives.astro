---
import type { Language } from "../../../lib/i18n";
import { loadChapterSection } from "../../../lib/i18n/chapter-loader";

interface Props {
    lang: Language;
}

const { lang } = Astro.props;

type ObjectivesContent = {
    title: string;
    sectionId: string;
    intro: string;
    objectives: Array<{
        marker: string;
        title: string;
        description: string;
        icon: string;
    }>;
};

const content = await loadChapterSection<ObjectivesContent>(
    1,
    "objectives",
    lang,
);

if (!content) {
    throw new Error("Objectives section content not found");
}
---

<section
    id="objectives"
    class="relative min-h-screen bg-[#050505] py-24 md:py-32"
>
    <!-- Animated Background Pattern (Removed per user request) -->
    <div class="absolute inset-0 pointer-events-none"></div>

    <div class="container mx-auto px-8 relative z-10">
        <!-- Section Header -->
        <div class="max-w-6xl mx-auto mb-20 reveal-item">
            <div
                class="inline-block px-6 py-2 bg-white/5 border border-white/10 mb-6"
            >
                <span class="text-zinc-500 font-serif text-sm tracking-wider"
                    >{content.sectionId}</span
                >
            </div>
            <h2
                class="font-serif text-[clamp(3rem,6vw,5rem)] md:text-[5.5rem] leading-[0.9] font-medium text-white tracking-tight mb-12"
            >
                {content.title}
            </h2>

            <!-- Introduction -->
            <div
                class="bg-white/[0.02] backdrop-blur-sm border border-white/5 p-8 md:p-12"
            >
                <p
                    class="text-zinc-400 font-serif text-lg md:text-xl leading-relaxed"
                >
                    {content.intro}
                </p>
            </div>
        </div>

        <!-- Objectives Grid -->
        <div class="max-w-6xl mx-auto">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8">
                {
                    content.objectives.map((objective, index) => (
                        <div
                            class="objective-card group reveal-item"
                            style={`--delay: ${(index + 1) * 150}ms`}
                        >
                            <div class="relative h-full bg-gradient-to-br from-white/[0.03] to-white/[0.01] backdrop-blur-sm border border-white/10 p-8 md:p-10 transition-all duration-700 hover:border-white/20 hover:bg-white/[0.05] hover:shadow-[0_20px_60px_rgba(0,0,0,0.4)] hover:-translate-y-2">
                                {/* Marker Badge */}
                                <div class="flex items-start justify-between mb-6">
                                    <div class="flex-shrink-0 w-12 h-12 flex items-center justify-center bg-white/10 border border-white/20 text-white font-serif text-xl group-hover:bg-white/15 group-hover:scale-110 transition-all duration-500">
                                        {objective.marker}
                                    </div>
                                </div>

                                {/* Title */}
                                <h3 class="font-serif text-2xl md:text-3xl text-white mb-4 tracking-tight leading-tight">
                                    {objective.title}
                                </h3>

                                {/* Description */}
                                <p class="text-zinc-500 font-serif text-base md:text-lg leading-relaxed">
                                    {objective.description}
                                </p>

                                {/* Hover Accent Line */}
                                <div class="absolute bottom-0 left-0 h-1 w-0 bg-white/30 group-hover:w-full transition-all duration-700" />
                            </div>
                        </div>
                    ))
                }
            </div>
        </div>

        <!-- Summary Count -->
        <div
            class="max-w-6xl mx-auto mt-20 reveal-item"
            style="--delay: 1000ms"
        >
            <div
                class="bg-gradient-to-r from-white/5 to-transparent border-l-4 border-white/10 p-8 md:p-10"
            >
                <div class="flex items-center gap-6">
                    <div
                        class="text-[clamp(3rem,8vw,6rem)] font-serif font-medium text-white/20 leading-none"
                    >
                        {content.objectives.length}
                    </div>
                    <p class="text-zinc-400 font-serif text-lg md:text-xl">
                        विशिष्ट उद्देश्यहरू परिभाषित गरिएका छन्
                    </p>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
    .reveal-item {
        opacity: 0;
        transform: translateY(40px);
        transition:
            opacity 1s cubic-bezier(0.2, 0.8, 0.2, 1),
            transform 1s cubic-bezier(0.2, 0.8, 0.2, 1);
        transition-delay: var(--delay, 0ms);
    }

    .reveal-item.active {
        opacity: 1;
        transform: translateY(0);
    }

    .objective-card {
        position: relative;
    }

    .objective-card::before {
        content: "";
        position: absolute;
        inset: 0;
        background: radial-gradient(
            600px circle at var(--mouse-x, 50%) var(--mouse-y, 50%),
            rgba(255, 255, 255, 0.06),
            transparent 40%
        );
        opacity: 0;
        transition: opacity 0.5s;
        pointer-events: none;
    }

    .objective-card:hover::before {
        opacity: 1;
    }
</style>

<script>
    // Intersection Observer for reveal animations
    const observerOptions = {
        threshold: 0.1,
        rootMargin: "0px 0px -100px 0px",
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
            if (entry.isIntersecting) {
                entry.target.classList.add("active");
            }
        });
    }, observerOptions);

    document.querySelectorAll(".reveal-item").forEach((item) => {
        observer.observe(item);
    });

    // Mouse move effect for objective cards
    document.querySelectorAll(".objective-card").forEach((card) => {
        const htmlCard = card as HTMLElement;
        htmlCard.addEventListener("mousemove", (e: MouseEvent) => {
            const rect = htmlCard.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            htmlCard.style.setProperty("--mouse-x", `${x}px`);
            htmlCard.style.setProperty("--mouse-y", `${y}px`);
        });
    });
</script>
