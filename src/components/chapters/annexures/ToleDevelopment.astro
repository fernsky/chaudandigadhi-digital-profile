---
import { loadChapterSection } from "../../../lib/i18n/chapter-loader";
import { formatNumber } from "../../../lib/i18n/formatters";
import type { Language } from "../../../lib/i18n";

interface Props {
    lang: Language;
}

const { lang } = Astro.props;

type ToleRow = {
    sn: string;
    regNo: string;
    name: string;
    address: string;
    chairman: string;
    contact?: string;
};
type WardSection = {
    title: string;
    headers: string[];
    source: string;
    rows: ToleRow[];
};
type SectionData = {
    id: string;
    title: string;
    wards: WardSection[];
    nextSection: string;
};

const data = await loadChapterSection<SectionData>(
    "annexures",
    "tole-development-organizations",
    lang,
);
---

{
    data && (
        <div
            id="tole-development-organizations"
            class="scroll-mt-32 space-y-12 mb-16 pt-8 border-t border-white/5"
        >
            <div>
                <h2 class="font-serif text-3xl md:text-4xl font-bold text-white mb-8">
                    <span class="text-[#f2e25d]">
                        {formatNumber(data.id, lang)}
                    </span>
                    : {data.title}
                </h2>

                {data.wards.map((ward: WardSection) => (
                    <div class="mb-16">
                        <h3 class="text-xl md:text-2xl font-serif font-semibold text-white mb-6 text-center opacity-90">
                            {ward.title}
                        </h3>

                        <div class="overflow-x-auto rounded-lg border border-[#f2e25d]/10 bg-white/5">
                            <table class="w-full text-left border-collapse">
                                <thead class="bg-[#f2e25d]/10 text-white font-serif text-lg">
                                    <tr>
                                        {ward.headers.map((header: string) => (
                                            <th class="px-6 py-4 border-b border-[#f2e25d]/20 font-bold text-[#f2e25d]">
                                                {header}
                                            </th>
                                        ))}
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-[#f2e25d]/10 text-zinc-300 font-serif">
                                    {ward.rows.map((row: any) => (
                                        <tr class="hover:bg-[#f2e25d]/5 transition-colors">
                                            <td class="px-6 py-3 opacity-70">
                                                {formatNumber(row.sn, lang)}
                                            </td>
                                            <td class="px-6 py-3">
                                                {formatNumber(row.regNo, lang)}
                                            </td>
                                            <td class="px-6 py-3 font-medium text-white">
                                                {row.name}
                                            </td>
                                            <td class="px-6 py-3">
                                                {row.address}
                                            </td>
                                            <td class="px-6 py-3 font-medium text-white">
                                                {row.chairman}
                                            </td>
                                            {ward.headers.length > 5 && (
                                                <td class="px-6 py-3 text-sm">
                                                    {row.contact
                                                        ? formatNumber(
                                                              row.contact,
                                                              lang,
                                                          )
                                                        : "-"}
                                                </td>
                                            )}
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                        {ward.source && (
                            <div class="text-right text-zinc-400 font-serif italic text-sm mt-2">
                                {lang === "ne" ? "स्रोत: " : "Source: "}
                                {ward.source}
                            </div>
                        )}
                    </div>
                ))}
            </div>
        </div>
    )
}
