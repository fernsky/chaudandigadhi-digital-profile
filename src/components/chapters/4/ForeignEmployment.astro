---
import type { Language } from "../../../lib/i18n";
import { loadChapterSection } from "../../../lib/i18n/chapter-loader";
import { formatNumber } from "../../../lib/i18n/formatters";
import ForeignEmploymentChart from "../../charts/chapter-4/ForeignEmploymentChart.astro";

interface Props {
    lang: Language;
}

const { lang } = Astro.props;

type ForeignEmploymentContent = {
    title: string;
    sectionId: string;
    number: string;
    intro: string;
    tableTitle: string;
    tableData: Array<{
        ageGroup: string;
        gender: string;
        india: number;
        saarc: number;
        asian: number;
        middleEast: number;
        otherAsian: number;
        europe: number;
        otherEurope: number;
        northAmerica: number;
        southAmerica: number;
        africa: number;
        pacific: number;
        other: number;
        undisclosed: number;
        total: number;
    }>;
    grandTotal: any;
    source: string;
    landless: {
        title: string;
        number: string;
        content: string;
    };
};

const content = await loadChapterSection<ForeignEmploymentContent>(
    4,
    "foreign-employment",
    lang,
);

if (!content) {
    throw new Error("Foreign employment content not found");
}

const chartData = [
    {
        label: lang === "ne" ? "भारत" : "India",
        value: content.grandTotal.india,
    },
    {
        label: lang === "ne" ? "सार्क" : "SAARC",
        value: content.grandTotal.saarc,
    },
    {
        label: lang === "ne" ? "एशियन" : "Asian",
        value: content.grandTotal.asian,
    },
    {
        label: lang === "ne" ? "मध्यपूर्व" : "Middle East",
        value: content.grandTotal.middleEast,
    },
    {
        label: lang === "ne" ? "अन्य एशियन" : "Other Asian",
        value: content.grandTotal.otherAsian,
    },
    {
        label: lang === "ne" ? "युरोप" : "Europe",
        value: content.grandTotal.europe,
    },
    {
        label: lang === "ne" ? "अन्य युरोप" : "Other Europe",
        value: content.grandTotal.otherEurope,
    },
    {
        label: lang === "ne" ? "उत्तर अमेरिका" : "North America",
        value: content.grandTotal.northAmerica,
    },
    {
        label: lang === "ne" ? "दक्षिण अमेरिका" : "South America",
        value: content.grandTotal.southAmerica,
    },
    {
        label: lang === "ne" ? "अफ्रिका" : "Africa",
        value: content.grandTotal.africa,
    },
    {
        label: lang === "ne" ? "प्यासिफिक" : "Pacific",
        value: content.grandTotal.pacific,
    },
    {
        label: lang === "ne" ? "अन्य" : "Other",
        value: content.grandTotal.other,
    },
    {
        label: lang === "ne" ? "खुल्न नसकेको" : "Undisclosed",
        value: content.grandTotal.undisclosed,
    },
].filter((d) => d.value > 0);
---

<section
    id="foreign-employment"
    class="relative bg-[#050505] py-8 md:py-12 scroll-mt-24"
>
    <div class="container mx-auto px-8">
        <div class="w-full mx-auto space-y-8">
            <h2
                class="font-serif text-2xl md:text-3xl font-medium text-zinc-100"
            >
                {formatNumber(content.number, lang)}
                {content.title}
            </h2>

            <p
                class="font-serif text-base md:text-lg text-zinc-300 leading-relaxed"
            >
                {content.intro}
            </p>

            <h3 class="font-serif text-lg md:text-xl text-zinc-200 font-medium">
                {content.tableTitle}
            </h3>

            <!-- Table 28 - Foreign Employment -->
            <div class="overflow-x-auto">
                <table class="w-full border-collapse text-sm">
                    <thead>
                        <tr class="border-b border-zinc-700">
                            <th
                                class="text-left py-2 px-2 font-serif text-xs md:text-sm text-zinc-300"
                                >{lang === "ne" ? "उमेर समूह" : "Age Group"}</th
                            >
                            <th
                                class="text-left py-2 px-2 font-serif text-xs md:text-sm text-zinc-300"
                                >{lang === "ne" ? "लिङ्ग" : "Gender"}</th
                            >
                            <th
                                class="text-right py-2 px-2 font-serif text-xs md:text-sm text-zinc-300"
                                >{lang === "ne" ? "भारत" : "India"}</th
                            >
                            <th
                                class="text-right py-2 px-2 font-serif text-xs md:text-sm text-zinc-300"
                                >{lang === "ne" ? "सार्क" : "SAARC"}</th
                            >
                            <th
                                class="text-right py-2 px-2 font-serif text-xs md:text-sm text-zinc-300"
                                >{lang === "ne" ? "एशियन" : "Asian"}</th
                            >
                            <th
                                class="text-right py-2 px-2 font-serif text-xs md:text-sm text-zinc-300"
                                >{
                                    lang === "ne" ? "मध्यपूर्व" : "Middle East"
                                }</th
                            >
                            <th
                                class="text-right py-2 px-2 font-serif text-xs md:text-sm text-zinc-300"
                                >{
                                    lang === "ne" ? "अन्य एशियन" : "Other Asian"
                                }</th
                            >
                            <th
                                class="text-right py-2 px-2 font-serif text-xs md:text-sm text-zinc-300"
                                >{lang === "ne" ? "युरोप" : "Europe"}</th
                            >
                            <th
                                class="text-right py-2 px-2 font-serif text-xs md:text-sm text-zinc-300"
                                >{
                                    lang === "ne"
                                        ? "अन्य युरोप"
                                        : "Other Europe"
                                }</th
                            >
                            <th
                                class="text-right py-2 px-2 font-serif text-xs md:text-sm text-zinc-300"
                                >{
                                    lang === "ne"
                                        ? "उत्तर अमेरिका"
                                        : "North America"
                                }</th
                            >
                            <th
                                class="text-right py-2 px-2 font-serif text-xs md:text-sm text-zinc-300"
                                >{lang === "ne" ? "जम्मा" : "Total"}</th
                            >
                        </tr>
                    </thead>
                    <tbody>
                        {
                            content.tableData.map((row: any) => (
                                <tr class="border-b border-zinc-800 hover:bg-zinc-900/30 transition-colors">
                                    <td class="py-2 px-2 font-serif text-xs md:text-sm text-zinc-300">
                                        {row.ageGroup}
                                    </td>
                                    <td class="py-2 px-2 font-serif text-xs md:text-sm text-zinc-300">
                                        {row.gender}
                                    </td>
                                    <td class="text-right py-2 px-2 font-serif text-xs md:text-sm text-zinc-300">
                                        {formatNumber(row.india, lang)}
                                    </td>
                                    <td class="text-right py-2 px-2 font-serif text-xs md:text-sm text-zinc-300">
                                        {formatNumber(row.saarc, lang)}
                                    </td>
                                    <td class="text-right py-2 px-2 font-serif text-xs md:text-sm text-zinc-300">
                                        {formatNumber(row.asian, lang)}
                                    </td>
                                    <td class="text-right py-2 px-2 font-serif text-xs md:text-sm text-zinc-300">
                                        {formatNumber(row.middleEast, lang)}
                                    </td>
                                    <td class="text-right py-2 px-2 font-serif text-xs md:text-sm text-zinc-300">
                                        {formatNumber(row.otherAsian, lang)}
                                    </td>
                                    <td class="text-right py-2 px-2 font-serif text-xs md:text-sm text-zinc-300">
                                        {formatNumber(row.europe, lang)}
                                    </td>
                                    <td class="text-right py-2 px-2 font-serif text-xs md:text-sm text-zinc-300">
                                        {formatNumber(row.otherEurope, lang)}
                                    </td>
                                    <td class="text-right py-2 px-2 font-serif text-xs md:text-sm text-zinc-300">
                                        {formatNumber(row.northAmerica, lang)}
                                    </td>
                                    <td class="text-right py-2 px-2 font-serif text-xs md:text-sm text-zinc-300 font-medium">
                                        {formatNumber(row.total, lang)}
                                    </td>
                                </tr>
                            ))
                        }
                        <tr class="border-t-2 border-zinc-600 bg-zinc-900/50">
                            <td
                                colspan="2"
                                class="py-3 px-2 font-serif text-xs md:text-sm text-zinc-100 font-bold"
                                >{lang === "ne" ? "जम्मा" : "Total"}</td
                            >
                            <td
                                class="text-right py-3 px-2 font-serif text-xs md:text-sm text-zinc-100 font-bold"
                                >{
                                    formatNumber(content.grandTotal.india, lang)
                                }</td
                            >
                            <td
                                class="text-right py-3 px-2 font-serif text-xs md:text-sm text-zinc-100 font-bold"
                                >{
                                    formatNumber(content.grandTotal.saarc, lang)
                                }</td
                            >
                            <td
                                class="text-right py-3 px-2 font-serif text-xs md:text-sm text-zinc-100 font-bold"
                                >{
                                    formatNumber(content.grandTotal.asian, lang)
                                }</td
                            >
                            <td
                                class="text-right py-3 px-2 font-serif text-xs md:text-sm text-zinc-100 font-bold"
                                >{
                                    formatNumber(
                                        content.grandTotal.middleEast,
                                        lang,
                                    )
                                }</td
                            >
                            <td
                                class="text-right py-3 px-2 font-serif text-xs md:text-sm text-zinc-100 font-bold"
                                >{
                                    formatNumber(
                                        content.grandTotal.otherAsian,
                                        lang,
                                    )
                                }</td
                            >
                            <td
                                class="text-right py-3 px-2 font-serif text-xs md:text-sm text-zinc-100 font-bold"
                                >{
                                    formatNumber(
                                        content.grandTotal.europe,
                                        lang,
                                    )
                                }</td
                            >
                            <td
                                class="text-right py-3 px-2 font-serif text-xs md:text-sm text-zinc-100 font-bold"
                                >{
                                    formatNumber(
                                        content.grandTotal.otherEurope,
                                        lang,
                                    )
                                }</td
                            >
                            <td
                                class="text-right py-3 px-2 font-serif text-xs md:text-sm text-zinc-100 font-bold"
                                >{
                                    formatNumber(
                                        content.grandTotal.northAmerica,
                                        lang,
                                    )
                                }</td
                            >
                            <td
                                class="text-right py-3 px-2 font-serif text-xs md:text-sm text-zinc-100 font-bold"
                                >{
                                    formatNumber(content.grandTotal.total, lang)
                                }</td
                            >
                        </tr>
                    </tbody>
                </table>
            </div>

            <div
                class="mt-8 border border-zinc-800 rounded-xl p-6 bg-zinc-900/30"
            >
                <h4 class="text-zinc-400 font-serif text-sm mb-4">
                    {
                        lang === "ne"
                            ? "वैदेशिक रोजगार गन्तव्य (जम्मा)"
                            : "Foreign Employment Destinations (Total)"
                    }
                </h4>
                <ForeignEmploymentChart data={chartData} />
            </div>

            <p class="text-sm text-zinc-400 font-serif italic">
                {lang === "ne" ? "स्रोत" : "Source"}: {content.source}
            </p>

            <!-- Landless Section -->
            <div id="landless" class="space-y-4 scroll-mt-24">
                <h3
                    class="font-serif text-xl md:text-2xl text-zinc-100 font-medium"
                >
                    {formatNumber(content.landless.number, lang)}
                    {content.landless.title}
                </h3>
                <p class="font-serif text-base text-zinc-300 leading-relaxed">
                    {content.landless.content}
                </p>
            </div>
        </div>
    </div>
</section>
