---
import { loadChapterSection } from "../../../lib/i18n/chapter-loader";
import type { Language } from "../../../lib/i18n";
import D3PieChart from "../../charts/D3PieChart.astro";
import D3BarChart from "../../charts/D3BarChart.astro";

interface Props {
    lang: Language;
}

const { lang } = Astro.props;

type EnergySection = {
    title: string;
    number: string;
    content1: string;
    content2: string;
    equationIntro: string;
    equation: string;
    content3: string;
};

type CookingFuelSection = {
    title: string;
    number: string;
    content: string;
    tableTitle: string;
    tableData: Array<{
        ward: string;
        wood: string;
        lpg: string;
        electricity: string;
        guitha: string;
        biogas: string;
        kerosene: string;
        others: string;
        total: string;
    }>;
    source: string;
    chartTitle: string;
    chartData: Array<{ label: string; value: number; color: string }>;
    content2: string;
};

type LightingFuelSection = {
    title: string;
    number: string;
    content: string;
    tableTitle: string;
    tableData: Array<{
        ward: string;
        electricity: string;
        solar: string;
        kerosene: string;
        biogas: string;
        others: string;
        total: string;
    }>;
    source: string;
    content2: string;
    chartTitle: string;
    chartData: Array<{ label: string; value: number; color: string }>;
};

type AlternativeEnergySection = {
    title: string;
    number: string;
    content: string;
};

const energy = (await loadChapterSection(
    7,
    "energy",
    lang
)) as EnergySection;

const cookingFuel = (await loadChapterSection(
    7,
    "cooking-fuel",
    lang
)) as CookingFuelSection;

const lightingFuel = (await loadChapterSection(
    7,
    "lighting-fuel",
    lang
)) as LightingFuelSection;

const alternativeEnergy = (await loadChapterSection(
    7,
    "alternative-energy",
    lang
)) as AlternativeEnergySection;

const equationHtml = energy?.equation
    ? energy.equation
          .replace(/\\times/g, "×")
          .replace(
              /\\frac{([^}]+)}{([^}]+)}/g,
              '<span class="inline-flex flex-col items-center align-middle mx-1"><span class="border-b border-[#f2e25d] pb-0.5">$1</span><span class="pt-0.5">$2</span></span>'
          )
    : "";
---

{
    energy && (
        <section
            id="electricity"
            class="relative bg-[#050505] pb-8 md:pb-12"
        >
            <div class="container mx-auto px-8">
                <div class="w-full mx-auto">
                    <div class="w-full">
                        <div class="mb-6">
                            <h2 class="font-serif text-3xl md:text-4xl font-medium text-zinc-100 mb-6">
                                {energy.number}&nbsp; {energy.title}
                            </h2>
                        </div>
                        <p class="text-zinc-100 font-serif text-lg md:text-xl font-light leading-relaxed mb-6">
                            {energy.content1}
                        </p>
                        <p class="text-zinc-100 font-serif text-lg md:text-xl font-light leading-relaxed mb-8">
                            {energy.content2}
                        </p>

                        <!-- Equation Section -->
                        <div class="mb-8 p-6 bg-[#0a0a0a] rounded-lg border border-[#f2e25d]/10">
                            <p class="text-zinc-100 font-serif text-lg md:text-xl font-light leading-relaxed mb-4">
                                {energy.equationIntro}
                            </p>
                            
                            <div class="flex justify-center my-6">
                                <div class="bg-[#f2e25d]/5 border border-[#f2e25d]/20 px-8 py-4 rounded">
                                    <span class="font-serif text-2xl md:text-3xl text-[#f2e25d] font-medium tracking-wide">
                                        <span set:html={equationHtml} />
                                    </span>
                                </div>
                            </div>
                        </div>

                        <p class="text-zinc-100 font-serif text-lg md:text-xl font-light leading-relaxed mb-12">
                            {energy.content3}
                        </p>
                    </div>

                    <!-- 7.2.1 Cooking Fuel -->
                    {cookingFuel && (
                        <div id="cooking-fuel" class="mb-16">
                            <div class="w-full mb-8">
                                <h3 class="font-serif text-2xl md:text-3xl font-medium text-zinc-100 mb-6">
                                    {cookingFuel.number}&nbsp; {cookingFuel.title}
                                </h3>
                                <p class="text-zinc-100 font-serif text-lg md:text-xl font-light leading-relaxed whitespace-pre-line mb-8">
                                    {cookingFuel.content}
                                </p>
                            </div>

                            <!-- Table 66 -->
                            <div class="mb-10 w-full mx-auto">
                                <h5 class="font-serif text-xl md:text-2xl text-zinc-100 font-medium mb-4 text-center">
                                    {cookingFuel.tableTitle}
                                </h5>
                                <div class="overflow-x-auto">
                                    <table class="w-full border-collapse bg-[#0a0a0a] border border-[#f2e25d]/10 text-sm md:text-base">
                                        <thead>
                                            <tr class="bg-[#f2e25d]/5 border-b border-[#f2e25d]/20">
                                                <th class="px-2 py-3 border-r border-[#f2e25d]/10 text-center font-serif text-zinc-100 font-medium">
                                                    {lang === "ne" ? "वडा" : "Ward"}
                                                </th>
                                                <th class="px-2 py-3 border-r border-[#f2e25d]/10 text-right font-serif text-zinc-100 font-medium">
                                                    {lang === "ne" ? "काठ/दाउरा" : "Wood"}
                                                </th>
                                                <th class="px-2 py-3 border-r border-[#f2e25d]/10 text-right font-serif text-zinc-100 font-medium">
                                                    {lang === "ne" ? "एल.पी. ग्याँस" : "LPG"}
                                                </th>
                                                <th class="px-2 py-3 border-r border-[#f2e25d]/10 text-right font-serif text-zinc-100 font-medium">
                                                    {lang === "ne" ? "विद्युत" : "Electricity"}
                                                </th>
                                                <th class="px-2 py-3 border-r border-[#f2e25d]/10 text-right font-serif text-zinc-100 font-medium">
                                                    {lang === "ne" ? "गुइँठा" : "Guitha"}
                                                </th>
                                                <th class="px-2 py-3 border-r border-[#f2e25d]/10 text-right font-serif text-zinc-100 font-medium">
                                                    {lang === "ne" ? "बायो ग्याँस" : "Biogas"}
                                                </th>
                                                <th class="px-2 py-3 border-r border-[#f2e25d]/10 text-right font-serif text-zinc-100 font-medium">
                                                    {lang === "ne" ? "मट्टितेल" : "Kerosene"}
                                                </th>
                                                <th class="px-2 py-3 border-r border-[#f2e25d]/10 text-right font-serif text-zinc-100 font-medium">
                                                    {lang === "ne" ? "अन्य" : "Others"}
                                                </th>
                                                <th class="px-2 py-3 text-right font-serif text-zinc-100 font-medium">
                                                    {lang === "ne" ? "जम्मा" : "Total"}
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {cookingFuel.tableData.map((row: any) => (
                                                <tr class="text-zinc-100 border-b border-[#f2e25d]/5 hover:bg-[#f2e25d]/5 transition-colors duration-200">
                                                    <td class="px-2 py-2 border-r border-[#f2e25d]/5 text-center font-medium bg-[#f2e25d]/5">
                                                        {row.ward}
                                                    </td>
                                                    <td class="px-2 py-2 border-r border-[#f2e25d]/5 text-right">
                                                        {row.wood}
                                                    </td>
                                                    <td class="px-2 py-2 border-r border-[#f2e25d]/5 text-right">
                                                        {row.lpg}
                                                    </td>
                                                    <td class="px-2 py-2 border-r border-[#f2e25d]/5 text-right">
                                                        {row.electricity}
                                                    </td>
                                                    <td class="px-2 py-2 border-r border-[#f2e25d]/5 text-right">
                                                        {row.guitha}
                                                    </td>
                                                    <td class="px-2 py-2 border-r border-[#f2e25d]/5 text-right">
                                                        {row.biogas}
                                                    </td>
                                                    <td class="px-2 py-2 border-r border-[#f2e25d]/5 text-right">
                                                        {row.kerosene}
                                                    </td>
                                                    <td class="px-2 py-2 border-r border-[#f2e25d]/5 text-right">
                                                        {row.others}
                                                    </td>
                                                    <td class="px-2 py-2 text-right font-bold bg-[#f2e25d]/5 text-[#f2e25d]">
                                                        {row.total}
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                                <p class="text-zinc-400 text-sm text-right mt-2 font-serif italic mb-8">
                                    {lang === "ne" ? "स्रोत:" : "Source:"} {cookingFuel.source}
                                </p>
                            </div>

                            <!-- Pie Chart Container -->
                            <div class="w-full mb-10">
                                <D3PieChart
                                    id="cooking-fuel-chart"
                                    title={cookingFuel.chartTitle}
                                    labels={cookingFuel.chartData.map(d => d.label)}
                                    data={cookingFuel.chartData.map(d => d.value)}
                                    colors={cookingFuel.chartData.map(d => d.color)}
                                    lang={lang}
                                    height={400}
                                />
                            </div>
                           
                            <div class="w-full">
                                <p class="text-zinc-100 font-serif text-lg md:text-xl font-light leading-relaxed mb-6">
                                    {cookingFuel.content2}
                                </p>
                            </div>
                        </div>
                    )}

                    <!-- 7.2.2 Lighting Fuel -->
                    {lightingFuel && (
                        <div id="lighting-fuel" class="mb-16">
                            <div class="w-full mb-8">
                                <h3 class="font-serif text-2xl md:text-3xl font-medium text-zinc-100 mb-6">
                                    {lightingFuel.number}&nbsp; {lightingFuel.title}
                                </h3>
                                <p class="text-zinc-100 font-serif text-lg md:text-xl font-light leading-relaxed mb-8">
                                    {lightingFuel.content}
                                </p>
                            </div>

                            <!-- Table 67 -->
                            <div class="mb-10 w-full mx-auto">
                                <h5 class="font-serif text-xl md:text-2xl text-zinc-100 font-medium mb-4 text-center">
                                    {lightingFuel.tableTitle}
                                </h5>
                                <div class="overflow-x-auto">
                                    <table class="w-full border-collapse bg-[#0a0a0a] border border-[#f2e25d]/10 text-sm md:text-base">
                                        <thead>
                                            <tr class="bg-[#f2e25d]/5 border-b border-[#f2e25d]/20">
                                                <th class="px-2 py-3 border-r border-[#f2e25d]/10 text-center font-serif text-zinc-100 font-medium">
                                                    {lang === "ne" ? "वडा" : "Ward"}
                                                </th>
                                                <th class="px-2 py-3 border-r border-[#f2e25d]/10 text-right font-serif text-zinc-100 font-medium">
                                                    {lang === "ne" ? "बिजुली" : "Electricity"}
                                                </th>
                                                <th class="px-2 py-3 border-r border-[#f2e25d]/10 text-right font-serif text-zinc-100 font-medium">
                                                    {lang === "ne" ? "सोलार" : "Solar"}
                                                </th>
                                                <th class="px-2 py-3 border-r border-[#f2e25d]/10 text-right font-serif text-zinc-100 font-medium">
                                                    {lang === "ne" ? "मट्टितेल" : "Kerosene"}
                                                </th>
                                                <th class="px-2 py-3 border-r border-[#f2e25d]/10 text-right font-serif text-zinc-100 font-medium">
                                                    {lang === "ne" ? "बायो ग्याँस" : "Biogas"}
                                                </th>
                                                <th class="px-2 py-3 border-r border-[#f2e25d]/10 text-right font-serif text-zinc-100 font-medium">
                                                    {lang === "ne" ? "अन्य" : "Others"}
                                                </th>
                                                <th class="px-2 py-3 text-right font-serif text-zinc-100 font-medium">
                                                    {lang === "ne" ? "जम्मा" : "Total"}
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {lightingFuel.tableData.map((row: any) => (
                                                <tr class="text-zinc-100 border-b border-[#f2e25d]/5 hover:bg-[#f2e25d]/5 transition-colors duration-200">
                                                    <td class="px-2 py-2 border-r border-[#f2e25d]/5 text-center font-medium bg-[#f2e25d]/5">
                                                        {row.ward}
                                                    </td>
                                                    <td class="px-2 py-2 border-r border-[#f2e25d]/5 text-right">
                                                        {row.electricity}
                                                    </td>
                                                    <td class="px-2 py-2 border-r border-[#f2e25d]/5 text-right">
                                                        {row.solar}
                                                    </td>
                                                    <td class="px-2 py-2 border-r border-[#f2e25d]/5 text-right">
                                                        {row.kerosene}
                                                    </td>
                                                    <td class="px-2 py-2 border-r border-[#f2e25d]/5 text-right">
                                                        {row.biogas}
                                                    </td>
                                                    <td class="px-2 py-2 border-r border-[#f2e25d]/5 text-right">
                                                        {row.others}
                                                    </td>
                                                    <td class="px-2 py-2 text-right font-bold bg-[#f2e25d]/5 text-[#f2e25d]">
                                                        {row.total}
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                                <p class="text-zinc-400 text-sm text-right mt-2 font-serif italic mb-8">
                                    {lang === "ne" ? "स्रोत:" : "Source:"} {lightingFuel.source}
                                </p>
                            </div>
                            
                            <div class="w-full mb-10">
                                 <p class="text-zinc-100 font-serif text-lg md:text-xl font-light leading-relaxed mb-6">
                                    {lightingFuel.content2}
                                </p>
                            </div>

                            <!-- Bar Chart Container -->
                            <div class="w-full mb-10">
                                <D3BarChart
                                    id="lighting-fuel-chart"
                                    title={lightingFuel.chartTitle}
                                    labels={lightingFuel.chartData.map(d => d.label)}
                                    data={lightingFuel.chartData.map(d => d.value)}
                                    lang={lang}
                                    height={400}
                                />
                            </div>
                        </div>
                    )}

                    <!-- 7.2.3 Alternative Energy -->
                    {alternativeEnergy && (
                        <div id="alternative-energy">
                            <div class="w-full">
                                <h3 class="font-serif text-2xl md:text-3xl font-medium text-zinc-100 mb-6">
                                    {alternativeEnergy.number}&nbsp; {alternativeEnergy.title}
                                </h3>
                                <p class="text-zinc-100 font-serif text-lg md:text-xl font-light leading-relaxed mb-6">
                                    {alternativeEnergy.content}
                                </p>
                            </div>
                        </div>
                    )}
                </div>
            </div>
        </section>
    )
}


