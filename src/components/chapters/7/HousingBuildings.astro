---
import { loadChapterSection } from "../../../lib/i18n/chapter-loader";
import { formatNumber } from "../../../lib/i18n/formatters";
import type { Language } from "../../../lib/i18n";
import D3PieChart from "../../charts/D3PieChart.astro";

interface Props {
    lang: Language;
}

const { lang } = Astro.props;

type HousingSection = {
    title: string;
    number: string;
    content: string;
};

type RoofTypeSection = {
    title: string;
    number: string;
    tableTitle: string;
    tableData: Array<{
        ward: string;
        zinc: string;
        cement: string;
        thatch: string;
        tile: string;
        stone: string;
        wood: string;
        others: string;
        total: string;
    }>;
    source: string;
    chartTitle: string;
    chartData: Array<{ label: string; value: number; color: string }>;
    content: string;
};

type GovtBuildingsSection = {
    title: string;
    number: string;
    content1: string;
    content2: string;
    tableTitle: string;
    tableData: Array<{
        sn: string;
        name: string;
        ward: string;
        status: string;
        remarks: string;
    }>;
    source: string;
    imageCaption1: string;
    imageCaption2: string;
};

type SlaughterhouseSection = {
    title: string;
    number: string;
    content: string;
};

type CrematoriumSection = {
    title: string;
    number: string;
    content: string;
};

const housing = (await loadChapterSection(
    7,
    "housing",
    lang
)) as HousingSection;

const roofType = (await loadChapterSection(
    7,
    "roof-types",
    lang
)) as RoofTypeSection;

const govtBuildings = (await loadChapterSection(
    7,
    "govt-buildings",
    lang
)) as GovtBuildingsSection;

const slaughterhouse = (await loadChapterSection(
    7,
    "slaughterhouse",
    lang
)) as SlaughterhouseSection;

const crematorium = (await loadChapterSection(
    7,
    "crematorium",
    lang
)) as CrematoriumSection;
---

<!-- 7.4 Housing and Buildings -->
{
    housing && (
        <section id="housing" class="relative bg-[#050505] pb-8 md:pb-12">
            <div class="container mx-auto px-8">
                <div class="w-full">
                    <div class="mb-6">
                        <h2 class="font-serif text-3xl md:text-4xl font-medium text-zinc-100 mb-6">
                            {housing.number}&nbsp; {housing.title}
                        </h2>
                        <p class="text-zinc-100 font-serif text-lg md:text-xl font-light leading-relaxed mb-6">
                            {housing.content}
                        </p>
                    </div>

                    <!-- 7.4.1 Roof Types -->
                    {roofType && (
                        <div id="roof-types" class="mb-16">
                            <h3 class="font-serif text-2xl md:text-3xl font-medium text-zinc-100 mb-6">
                                {roofType.number}&nbsp; {roofType.title}
                            </h3>
                            
                            <!-- Table 70 -->
                             <div class="mb-10 w-full -mx-4 md:mx-auto">
                                <h5 class="font-serif text-xl md:text-2xl text-zinc-100 font-medium mb-4 text-center">
                                    {roofType.tableTitle}
                                </h5>
                                <div class="overflow-x-auto">
                                    <table class="w-full border-collapse bg-[#0a0a0a] border border-[#f2e25d]/10 text-sm md:text-base">
                                        <thead>
                                            <tr class="bg-[#f2e25d]/5 border-b border-[#f2e25d]/20">
                                                <th class="px-2 py-3 border-r border-[#f2e25d]/10 text-center font-serif text-zinc-100 font-medium">
                                                    {lang === "ne" ? "वडा" : "Ward"}
                                                </th>
                                                <th class="px-2 py-3 border-r border-[#f2e25d]/10 text-right font-serif text-zinc-100 font-medium">
                                                    {lang === "ne" ? "जस्ता/टिन" : "Zinc/Tin"}
                                                </th>
                                                <th class="px-2 py-3 border-r border-[#f2e25d]/10 text-right font-serif text-zinc-100 font-medium">
                                                    {lang === "ne" ? "सिमेन्ट/ ढलान" : "Cement"}
                                                </th>
                                                <th class="px-2 py-3 border-r border-[#f2e25d]/10 text-right font-serif text-zinc-100 font-medium">
                                                    {lang === "ne" ? "खर/पराल" : "Thatch"}
                                                </th>
                                                <th class="px-2 py-3 border-r border-[#f2e25d]/10 text-right font-serif text-zinc-100 font-medium">
                                                    {lang === "ne" ? "टायल" : "Tile"}
                                                </th>
                                                <th class="px-2 py-3 border-r border-[#f2e25d]/10 text-right font-serif text-zinc-100 font-medium">
                                                    {lang === "ne" ? "ढुङ्गा/स्लेट" : "Stone"}
                                                </th>
                                                <th class="px-2 py-3 border-r border-[#f2e25d]/10 text-right font-serif text-zinc-100 font-medium">
                                                    {lang === "ne" ? "काठ/फल्याक" : "Wood"}
                                                </th>
                                                <th class="px-2 py-3 border-r border-[#f2e25d]/10 text-right font-serif text-zinc-100 font-medium">
                                                    {lang === "ne" ? "अन्य" : "Others"}
                                                </th>
                                                <th class="px-2 py-3 text-right font-serif text-zinc-100 font-medium">
                                                    {lang === "ne" ? "जम्मा" : "Total"}
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {roofType.tableData.map((row: any) => (
                                                <tr class="text-zinc-100 border-b border-[#f2e25d]/5 hover:bg-[#f2e25d]/5 transition-colors duration-200">
                                                    <td class="px-2 py-2 border-r border-[#f2e25d]/5 text-center font-medium bg-[#f2e25d]/5">
                                                        {formatNumber(row.ward, lang)}
                                                    </td>
                                                    <td class="px-2 py-2 border-r border-[#f2e25d]/5 text-right">
                                                        {formatNumber(row.zinc, lang)}
                                                    </td>
                                                    <td class="px-2 py-2 border-r border-[#f2e25d]/5 text-right">
                                                        {formatNumber(row.cement, lang)}
                                                    </td>
                                                    <td class="px-2 py-2 border-r border-[#f2e25d]/5 text-right">
                                                        {formatNumber(row.thatch, lang)}
                                                    </td>
                                                    <td class="px-2 py-2 border-r border-[#f2e25d]/5 text-right">
                                                        {formatNumber(row.tile, lang)}
                                                    </td>
                                                    <td class="px-2 py-2 border-r border-[#f2e25d]/5 text-right">
                                                        {formatNumber(row.stone, lang)}
                                                    </td>
                                                    <td class="px-2 py-2 border-r border-[#f2e25d]/5 text-right">
                                                        {formatNumber(row.wood, lang)}
                                                    </td>
                                                    <td class="px-2 py-2 border-r border-[#f2e25d]/5 text-right">
                                                        {formatNumber(row.others, lang)}
                                                    </td>
                                                    <td class="px-2 py-2 text-right font-bold bg-[#f2e25d]/5 text-[#f2e25d]">
                                                        {formatNumber(row.total, lang)}
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                                <p class="text-zinc-400 text-sm text-right mt-2 font-serif italic mb-8">
                                    {lang === "ne" ? "स्रोत:" : "Source:"} {roofType.source}
                                </p>
                            </div>

                            <!-- Pie Chart -->
                            <div class="mb-10">
                                <D3PieChart
                                    id="roof-type-chart"
                                    title={roofType.chartTitle}
                                    labels={roofType.chartData.map(d => d.label)}
                                    data={roofType.chartData.map(d => d.value)}
                                    colors={roofType.chartData.map(d => d.color)}
                                    lang={lang}
                                    height={450}
                                />
                            </div>

                            <p class="text-zinc-100 font-serif text-lg md:text-xl font-light leading-relaxed mb-6">
                                {roofType.content}
                            </p>
                        </div>
                    )}

                    <!-- 7.4.2 Govt Buildings -->
                     {govtBuildings && (
                        <div id="govt-buildings" class="mb-16">
                            <h3 class="font-serif text-2xl md:text-3xl font-medium text-zinc-100 mb-6">
                                {govtBuildings.number}&nbsp; {govtBuildings.title}
                            </h3>
                            <p class="text-zinc-100 font-serif text-lg md:text-xl font-light leading-relaxed mb-6">
                                {govtBuildings.content1}
                            </p>
                            <p class="text-zinc-100 font-serif text-lg md:text-xl font-light leading-relaxed mb-8">
                                {govtBuildings.content2}
                            </p>

                            <!-- Table 71 -->
                            <div class="mb-10">
                                <h5 class="font-serif text-xl md:text-2xl text-zinc-100 font-medium mb-4 text-center">
                                    {govtBuildings.tableTitle}
                                </h5>
                                <div class="overflow-x-auto">
                                    <table class="w-full border-collapse bg-[#0a0a0a] border border-[#f2e25d]/10 text-sm md:text-base">
                                        <thead>
                                            <tr class="bg-[#f2e25d]/5 border-b border-[#f2e25d]/20">
                                                <th class="px-3 py-3 border-r border-[#f2e25d]/10 text-center w-12 font-serif text-zinc-100 font-medium">
                                                    {lang === "ne" ? "क्र.सं." : "SN"}
                                                </th>
                                                <th class="px-3 py-3 border-r border-[#f2e25d]/10 text-left font-serif text-zinc-100 font-medium">
                                                    {lang === "ne" ? "भवनको नाम" : "Building Name"}
                                                </th>
                                                <th class="px-3 py-3 border-r border-[#f2e25d]/10 text-center font-serif text-zinc-100 font-medium">
                                                    {lang === "ne" ? "वडा नं." : "Ward No."}
                                                </th>
                                                <th class="px-3 py-3 border-r border-[#f2e25d]/10 text-left font-serif text-zinc-100 font-medium">
                                                    {lang === "ne" ? "अवस्था" : "Status"}
                                                </th>
                                                <th class="px-3 py-3 text-left font-serif text-zinc-100 font-medium">
                                                    {lang === "ne" ? "कैफियत" : "Remarks"}
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {govtBuildings.tableData.map((row: any) => (
                                                <tr class="text-zinc-100 border-b border-[#f2e25d]/5 hover:bg-[#f2e25d]/5 transition-colors duration-200">
                                                    <td class="px-3 py-2 border-r border-[#f2e25d]/5 text-center font-medium">
                                                        {formatNumber(row.sn, lang)}
                                                    </td>
                                                    <td class="px-3 py-2 border-r border-[#f2e25d]/5">
                                                        {row.name}
                                                    </td>
                                                    <td class="px-3 py-2 border-r border-[#f2e25d]/5 text-center">
                                                        {formatNumber(row.ward, lang)}
                                                    </td>
                                                    <td class="px-3 py-2 border-r border-[#f2e25d]/5">
                                                        {row.status}
                                                    </td>
                                                    <td class="px-3 py-2">
                                                        {row.remarks}
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                                <p class="text-zinc-400 text-sm text-right mt-2 font-serif italic">
                                    {lang === "ne" ? "स्रोत:" : "Source:"} {govtBuildings.source}
                                </p>
                            </div>

                            <!-- Ward 1 Office Image -->
                            <figure class="mb-10">
                                <div class="w-full h-[500px] bg-zinc-900/50 rounded overflow-hidden border border-[#f2e25d]/20 mb-4">
                                    <img src="/images/chapter-7/वार्ड १ अफिस.png" alt="Ward 1 Office" class="w-full h-full object-cover transition-transform duration-700 hover:scale-105" />
                                </div>
                                <figcaption class="text-center font-bold text-zinc-200 font-serif text-lg md:text-xl">
                                    {govtBuildings.imageCaption1}
                                </figcaption>
                            </figure>

                            <!-- Ward 4 Office Image -->
                            <figure class="mb-10">
                                <div class="w-full h-[500px] bg-zinc-900/50 rounded overflow-hidden border border-[#f2e25d]/20 mb-4">
                                     <img src="/images/chapter-7/वार्ड ४ अफिस.png" alt="Ward 4 Office" class="w-full h-full object-cover transition-transform duration-700 hover:scale-105" />
                                </div>
                                <figcaption class="text-center font-bold text-zinc-200 font-serif text-lg md:text-xl">
                                    {govtBuildings.imageCaption2}
                                </figcaption>
                            </figure>
                        </div>
                     )}

                     <!-- 7.4.3 Slaughterhouse -->
                     {slaughterhouse && (
                        <div id="slaughterhouse" class="mb-16">
                             <h3 class="font-serif text-2xl md:text-3xl font-medium text-zinc-100 mb-6">
                                {slaughterhouse.number}&nbsp; {slaughterhouse.title}
                            </h3>
                            <p class="text-zinc-100 font-serif text-lg md:text-xl font-light leading-relaxed mb-6">
                                {slaughterhouse.content}
                            </p>
                        </div>
                     )}

                     <!-- 7.4.4 Crematorium -->
                     {crematorium && (
                        <div id="crematorium">
                             <h3 class="font-serif text-2xl md:text-3xl font-medium text-zinc-100 mb-6">
                                {crematorium.number}&nbsp; {crematorium.title}
                            </h3>
                            <p class="text-zinc-100 font-serif text-lg md:text-xl font-light leading-relaxed mb-6">
                                {crematorium.content}
                            </p>
                        </div>
                     )}
                </div>
            </div>
        </section>
    )
}


