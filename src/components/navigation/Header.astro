---
import type { Language } from "../../lib/i18n";
import { getTranslations, allChapters } from "../../lib/i18n";
import LanguageSwitcher from "./LanguageSwitcher.astro";

interface Props {
  lang: Language;
  currentChapter?: number;
}

const { lang, currentChapter } = Astro.props;
const t = getTranslations(lang);
---

<header
  class="sticky top-0 z-50 bg-slate-950 shadow-md no-print border-b border-slate-800"
>
  <div class="container">
    <div class="flex items-center justify-between py-4">
      <!-- Logo and Title -->
      <a
        href={`/${lang}/`}
        class="flex items-center gap-3 hover:opacity-80 transition-opacity"
      >
        <img
          src="/images/logo.svg"
          alt="Government of Nepal Emblem"
          class="w-12 h-12 object-contain"
        />
        <div>
          <h1 class="text-lg font-bold text-slate-100 leading-tight">
            {
              lang === "ne"
                ? "चौदण्डीगढी नगरपालिका"
                : "Chaudandigadhi Municipality"
            }
          </h1>
          <p class="text-xs text-slate-400">
            {lang === "ne" ? "डिजिटल प्रोफाइल" : "Digital Profile"}
          </p>
        </div>
      </a>

      <!-- Desktop Navigation -->
      <nav class="hidden md:flex items-center gap-6">
        <a
          href={`/${lang}/`}
          class={`font-medium transition-colors ${!currentChapter ? "text-primary-400" : "text-slate-300 hover:text-primary-400"}`}
        >
          {t.nav.home}
        </a>

        <!-- Chapters Dropdown -->
        <div class="relative group">
          <button
            class="font-medium text-slate-300 hover:text-primary-400 transition-colors flex items-center gap-1"
          >
            {t.nav.chapters}
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M19 9l-7 7-7-7"></path>
            </svg>
          </button>

          <div
            class="absolute top-full left-0 mt-2 w-80 bg-slate-900 shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 border border-slate-700"
          >
            <div class="p-2 max-h-96 overflow-y-auto">
              {
                allChapters.map((num) => {
                  const chapter = t.chapters[num];
                  return (
                    <a
                      href={`/${lang}/${chapter.slug}`}
                      class={`block px-4 py-3 transition-colors ${
                        currentChapter === num
                          ? "bg-primary-900 text-primary-300"
                          : "hover:bg-slate-800"
                      }`}
                    >
                      <div class="font-semibold text-sm text-slate-200">
                        {chapter.title}
                      </div>
                      <div class="text-xs text-slate-400 mt-1">
                        {chapter.description}
                      </div>
                    </a>
                  );
                })
              }
            </div>
          </div>
        </div>

        <a
          href={`/${lang}/annexures`}
          class="font-medium text-slate-300 hover:text-primary-400 transition-colors"
        >
          {t.nav.annexures}
        </a>

        <LanguageSwitcher lang={lang} currentPath={Astro.url.pathname} />
      </nav>

      <!-- Mobile Menu Button -->
      <button
        id="mobile-menu-button"
        class="md:hidden p-2 text-slate-300 hover:text-primary-400 transition-colors"
        aria-label="Toggle menu"
      >
        <svg
          class="w-6 h-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div
    id="mobile-menu"
    class="md:hidden hidden bg-slate-900 border-t border-slate-800"
  >
    <div class="container py-4">
      <nav class="flex flex-col gap-2">
        <a
          href={`/${lang}/`}
          class={`px-4 py-2 transition-colors ${!currentChapter ? "bg-primary-900 text-primary-300" : "hover:bg-slate-800"}`}
        >
          {t.nav.home}
        </a>

        <div class="px-4 py-2 font-semibold text-slate-200 text-sm">
          {t.nav.chapters}
        </div>

        {
          allChapters.map((num) => {
            const chapter = t.chapters[num];
            return (
              <a
                href={`/${lang}/${chapter.slug}`}
                class={`px-6 py-2 transition-colors text-sm ${
                  currentChapter === num
                    ? "bg-primary-900 text-primary-300"
                    : "hover:bg-slate-800"
                }`}
              >
                {chapter.title}
              </a>
            );
          })
        }

        <a
          href={`/${lang}/annexures`}
          class="px-4 py-2 hover:bg-slate-800 transition-colors"
        >
          {t.nav.annexures}
        </a>

        <div class="px-4 py-2 mt-2">
          <LanguageSwitcher lang={lang} currentPath={Astro.url.pathname} />
        </div>
      </nav>
    </div>
  </div>
</header>

<script>
  const mobileMenuButton = document.getElementById("mobile-menu-button");
  const mobileMenu = document.getElementById("mobile-menu");

  mobileMenuButton?.addEventListener("click", () => {
    mobileMenu?.classList.toggle("hidden");
  });
</script>
