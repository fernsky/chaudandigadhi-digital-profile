---
import type { Language } from "../../../lib/i18n";
import { getTranslations } from "../../../lib/i18n";

interface Props {
  lang: Language;
  currentChapter?: number;
  allChapters: readonly number[];
}

const { lang, currentChapter, allChapters } = Astro.props;
const t = getTranslations(lang);
---

<!-- Category Navigation (Left Side) -->
<nav class="flex-shrink-0 w-64">
  <h3 class="text-xs uppercase tracking-widest text-slate-500 font-semibold mb-4 px-4">
    {t.nav.chapters}
  </h3>
  <ul class="space-y-1" role="menu">
    {
      allChapters.map((num) => {
        const chapter = t.chapters[num];
        const isActive = currentChapter === num;
        return (
          <li role="none">
            <button
              data-chapter={num}
              class={`mega-menu-category group/cat w-full text-left px-4 py-3 rounded-md transition-all duration-200 border border-transparent ${
                isActive
                  ? "bg-primary-500/10 text-primary-300 font-medium border-primary-500/20"
                  : "text-slate-400 hover:bg-slate-800/50 hover:text-slate-200 hover:border-slate-700/50"
              }`}
              role="menuitem"
              aria-current={isActive ? "page" : undefined}
            >
              <div class="flex items-center justify-between gap-3">
                <div class="flex-1 min-w-0">
                  <p class="text-sm font-medium line-clamp-2">
                    {chapter.description}
                  </p>
                </div>
                <svg
                  class="flex-shrink-0 w-4 h-4 opacity-0 group-hover/cat:opacity-100 transition-all duration-200 transform group-hover/cat:translate-x-1"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 5l7 7-7 7"
                  />
                </svg>
              </div>
            </button>
          </li>
        );
      })
    }
  </ul>
</nav>

<script>
  // Category hover interaction to update content area
  const categoryButtons = document.querySelectorAll(".mega-menu-category");

  categoryButtons.forEach((button) => {
    button.addEventListener("mouseenter", () => {
      const chapterNum = button.getAttribute("data-chapter");
      if (chapterNum) {
        // Trigger custom event to update content area
        document.dispatchEvent(
          new CustomEvent("megamenu:categoryChange", {
            detail: { chapter: parseInt(chapterNum) },
          }),
        );
      }
    });

    button.addEventListener("click", (e) => {
      e.preventDefault();
      const chapterNum = button.getAttribute("data-chapter");
      if (chapterNum) {
        const lang = document.documentElement.lang || "ne";
        const slug = `chapter-${chapterNum}`;
        window.location.href = `/${lang}/${slug}`;
      }
    });
  });
</script>
