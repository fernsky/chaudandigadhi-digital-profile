---
import type { Language } from "../../../lib/i18n";
import { getTranslations } from "../../../lib/i18n";

interface Props {
  lang: Language;
  currentChapter?: number;
  allChapters: readonly number[];
}

const { lang, currentChapter, allChapters } = Astro.props;
const t = getTranslations(lang);
---

<!-- Category Navigation (Left Side) -->
<nav class="flex-shrink-0 w-80 border-r border-slate-700 h-full overflow-y-auto scrollbar-hide">
  <div class="py-2">
    <ul class="space-y-0" role="menu">
      {
        allChapters.map((num) => {
          const chapter = t.chapters[num];
          const isActive = currentChapter === num;
          return (
            <li role="none">
              <button
                data-chapter={num}
                class={`mega-menu-category group/cat w-full text-left px-6 py-5 transition-all duration-150 ${
                  isActive
                    ? "bg-primary-500/10 text-white font-medium"
                    : "text-slate-200 hover:bg-slate-800/60 hover:text-white"
                }`}
                role="menuitem"
                aria-current={isActive ? "page" : undefined}
              >
                <div class="flex items-center justify-between gap-4">
                  <div class="flex-1 min-w-0">
                    <p class="text-base leading-relaxed">
                      {chapter.description}
                    </p>
                  </div>
                  <svg
                    class="flex-shrink-0 w-5 h-5 opacity-50 group-hover/cat:opacity-100 transition-all duration-150"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9 5l7 7-7 7"
                    />
                  </svg>
                </div>
              </button>
            </li>
          );
        })
      }
    </ul>
  </div>
</nav>

<style>
  /* Hide scrollbar */
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    // Category hover interaction to update content area
    const categoryButtons = document.querySelectorAll(".mega-menu-category");

    categoryButtons.forEach((button) => {
      // Update content on hover
      button.addEventListener("mouseenter", () => {
        // Remove active state from all buttons
        categoryButtons.forEach((btn) => {
          btn.classList.remove("bg-primary-500/10", "text-white", "font-medium");
          btn.classList.add("text-slate-200");
        });

        // Add active state to hovered button
        button.classList.remove("text-slate-200");
        button.classList.add("bg-primary-500/10", "text-white", "font-medium");

        const chapterNum = button.getAttribute("data-chapter");
        if (chapterNum) {
          // Trigger custom event to update content area
          document.dispatchEvent(
            new CustomEvent("megamenu:categoryChange", {
              detail: { chapter: parseInt(chapterNum) },
            }),
          );
        }
      });

      // Navigate on click
      button.addEventListener("click", (e) => {
        e.preventDefault();
        const chapterNum = button.getAttribute("data-chapter");
        if (chapterNum) {
          const lang = document.documentElement.lang || "ne";
          const slug = `chapter-${chapterNum}`;
          window.location.href = `/${lang}/${slug}`;
        }
      });
    });
  });
</script>
