---
import type { Language } from "../../../lib/i18n";
import { getTranslations } from "../../../lib/i18n";

interface Props {
  lang: Language;
  currentChapter?: number;
  allChapters: readonly number[];
}

const { lang, currentChapter, allChapters } = Astro.props;
const t = getTranslations(lang);
---

<!-- Category Navigation (Left Side) -->
<nav
  class="flex-shrink-0 w-80 border-r border-slate-700 h-full overflow-y-auto scrollbar-hide"
>
  <div class="py-6">
    <ul class="space-y-0" role="menu">
      {
        allChapters.map((num) => {
          const chapter = t.chapters[num as unknown as keyof typeof t.chapters];
          const isActive = currentChapter === num;
          return (
            <li role="none">
              <button
                data-chapter={num}
                class={`mega-menu-category group/cat w-full text-left px-6 py-5 transition-all duration-200 ${
                  isActive
                    ? "text-primary-400 font-medium underline decoration-1 underline-offset-4"
                    : "text-slate-300 hover:text-primary-400"
                }`}
                role="menuitem"
                aria-current={isActive ? "page" : undefined}
              >
                <div class="flex items-center justify-between gap-4">
                  <div class="flex-1 min-w-0">
                    <p class="text-xl leading-relaxed group-hover/cat:underline decoration-primary-400/50 underline-offset-4 decoration-1 transition-all duration-200">
                      {chapter.title}
                    </p>
                  </div>
                </div>
              </button>
            </li>
          );
        })
      }
    </ul>
  </div>
</nav>

<style>
  /* Hide scrollbar */
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    // Category hover interaction to update content area
    const categoryButtons = document.querySelectorAll(".mega-menu-category");

    categoryButtons.forEach((button) => {
      // Update content on hover
      button.addEventListener("mouseenter", () => {
        // Remove active state from all buttons
        categoryButtons.forEach((btn) => {
          btn.classList.remove(
            "bg-primary-500/10",
            "text-white",
            "font-medium",
          );
          btn.classList.add("text-slate-200");
        });

        // Add active state to hovered button
        button.classList.remove("text-slate-200");
        button.classList.add("bg-primary-500/10", "text-white", "font-medium");

        const chapterNum = button.getAttribute("data-chapter");
        if (chapterNum) {
          // Trigger custom event to update content area
          document.dispatchEvent(
            new CustomEvent("megamenu:categoryChange", {
              detail: { chapter: parseInt(chapterNum) },
            }),
          );
        }
      });

      // Navigate on click
      button.addEventListener("click", (e) => {
        e.preventDefault();
        const chapterNum = button.getAttribute("data-chapter");
        if (chapterNum) {
          const lang = document.documentElement.lang || "ne";
          const slug = `chapter-${chapterNum}`;
          window.location.href = `/${lang}/${slug}`;
        }
      });
    });
  });
</script>
