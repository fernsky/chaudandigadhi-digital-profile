---
import type { Language } from "../../lib/i18n";
import { getTranslations } from "../../lib/i18n";
import { ChevronDown } from "lucide-astro";

interface Props {
    lang: Language;
}

const { lang } = Astro.props;
const t = getTranslations(lang);

const languages = [
    { code: "en", label: "English" },
    { code: "ne", label: "नेपाली" },
];

const currentLang = languages.find((l) => l.code === lang) || languages[0];
---

<header
    id="premium-header"
    class="absolute top-0 left-0 right-0 z-50 transition-all duration-500 ease-in-out border-b border-transparent"
>
    <div
        class="absolute inset-0 bg-slate-950/0 backdrop-blur-[0px] transition-all duration-500"
        id="header-bg"
    >
    </div>

    <div class="container mx-auto px-6 md:px-12 !py-8 relative z-10">
        <div class="flex items-center justify-between">
            <!-- Left: Logo -->
            <a href={`/${lang}/`} class="flex items-center gap-4 group">
                <div class="relative">
                    <div
                        class="absolute inset-0 bg-primary-500/20 blur-xl opacity-0 group-hover:opacity-100 transition-opacity duration-700"
                    >
                    </div>
                    <img
                        src="/images/logo.svg"
                        alt="Chaudandigadhi Municipality"
                        class="w-16 h-16 md:w-20 md:h-20 object-contain drop-shadow-2xl transition-transform duration-500 group-hover:scale-105"
                    />
                </div>
                <div class="hidden md:flex flex-col">
                    <span
                        class="text-slate-100 font-serif text-2xl tracking-wide leading-none group-hover:text-white transition-colors"
                    >
                        {t.home.hero.chaudandigadhi}
                    </span>
                    <span
                        class="text-slate-400 font-serif text-sm tracking-wide mt-1 group-hover:text-slate-300 transition-colors"
                    >
                        {t.home.hero.municipality}
                    </span>
                </div>
            </a>

            <!-- Right: Actions -->
            <div class="flex items-center gap-8">
                <!-- Premium Language Dropdown -->
                <div class="relative" id="lang-dropdown">
                    <button
                        class="flex items-center gap-2 py-2 transition-all duration-300 group"
                        aria-expanded="false"
                        aria-haspopup="true"
                    >
                        <span
                            class="text-slate-300 font-serif text-lg tracking-wide group-hover:text-white transition-colors"
                        >
                            {currentLang.label}
                        </span>
                        <ChevronDown
                            size={14}
                            class="text-slate-500 group-hover:text-slate-300 transition-transform duration-300 group-aria-expanded:rotate-180"
                        />
                    </button>

                    <!-- Dropdown Menu -->
                    <div
                        class="absolute top-full right-0 mt-0 w-40 opacity-0 invisible translate-y-2 transition-all duration-300 ease-out z-50 pt-0"
                        id="lang-menu"
                    >
                        <div
                            class="absolute inset-0 bg-slate-900/95 backdrop-blur-xl border border-slate-800 shadow-[0_20px_40px_-5px_rgba(0,0,0,0.4)]"
                        >
                        </div>
                        <div class="relative z-10 flex flex-col">
                            {
                                languages.map((l) => (
                                    <a
                                        href={Astro.url.pathname.replace(
                                            `/${lang}/`,
                                            `/${l.code}/`,
                                        )}
                                        class={`flex items-center justify-between px-6 py-3 transition-all duration-200 group/item border-b border-white/5 last:border-0 ${
                                            l.code === lang
                                                ? "text-white"
                                                : "text-slate-400 hover:text-white hover:bg-white/5"
                                        }`}
                                    >
                                        <span class="font-serif text-base tracking-wide">
                                            {l.label}
                                        </span>
                                    </a>
                                ))
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>

<script>
    // Language Dropdown Logic
    const dropdown = document.getElementById("lang-dropdown");
    const button = dropdown?.querySelector("button");
    const menu = document.getElementById("lang-menu");

    let isOpen = false;

    function toggleDropdown() {
        isOpen = !isOpen;
        button?.setAttribute("aria-expanded", isOpen.toString());

        if (isOpen) {
            menu?.classList.remove("opacity-0", "invisible", "translate-y-2");
            menu?.classList.add("opacity-100", "visible", "translate-y-0");
        } else {
            menu?.classList.add("opacity-0", "invisible", "translate-y-2");
            menu?.classList.remove("opacity-100", "visible", "translate-y-0");
        }
    }

    // Click outside to close
    document.addEventListener("click", (e) => {
        if (!dropdown?.contains(e.target as Node)) {
            if (isOpen) toggleDropdown();
        }
    });

    button?.addEventListener("click", (e) => {
        e.stopPropagation();
        toggleDropdown();
    });
</script>
